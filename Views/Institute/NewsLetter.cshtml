@model List<GECP_Front_End_Static.Models.NewsLettersModel>
@{
	Layout = "~/Views/Shared/_Layout.cshtml";
	ViewBag.Title = "News Letter";

	// Get the first item to initialize the preview area
	var firstItem = Model != null && Model.Count > 0 ? Model.First() : null;
}



<div class="page_title3 placement_title">
	<div class="container">
		<h1>
			<br> PRAGYAANAM <em>Newsletter Series Government Engineering College Patan</em>
			<div class="line"></div>
			<br>
		</h1>
	</div>
</div>
<div class="clearfix"></div>

<div class="content_fullwidth less">

	@if (Model != null && Model.Count > 0)
	{
		<div class="split-container">

			<div class="list-panel">
				@for (int i = 0; i < Model.Count; i++)
				{
					var item = Model[i];
					// Add 'active' class to the first item by default
					var activeClass = (i == 0) ? "active" : "";

					<div class="list-item @activeClass"
						 onclick="selectNewsletter(this, '@Url.Content(item.Thumb)', '@item.Title', '@Url.Content(item.File)')">

						<img src="@Url.Content(item.Thumb)" alt="thumb" />

						<div class="list-item-info">
							<h4>@item.Title</h4>
							<small style="color:#888;">Click to preview</small>
						</div>
					</div>
				}
			</div>

			<div class="preview-panel">
				<div class="preview-image-container">
					<img id="previewImg" src="@Url.Content(firstItem.Thumb)" alt="Preview" />
				</div>

				<h2 id="previewTitle" class="preview-title">@firstItem.Title</h2>

				<a id="previewBtn"
				   href="javascript:void(0);"
				   class="btn-preview-read"
				   data-file="@Url.Content(firstItem.File)"
				   data-title="@firstItem.Title">
					<i class="fa fa-book-reader"></i> Read Full Newsletter
				</a>
			</div>

		</div>
	}
	else
	{
		<div class="container" style="text-align:center; padding:50px;">
			<h3>No Newsletters Found.</h3>
		</div>
	}

</div>

@* <div id="popupOverlay" class="popup-overlay"></div>
<div id="popup">
	<div class="popup-close">&times;</div>
	<div id="pdfreader" style="width:100%; height:100%;"></div>
</div> *@

<div class="clearfix"></div>

@section scripts {
	<script src="@Url.Content("~/js/pdfobject/pdfobject.min.js")"></script>

	<script>
		// 1. Function to switch the content in the right panel
		function selectNewsletter(element, imagePath, title, pdfPath) {
			// Remove active class from all items
			jQuery('.list-item').removeClass('active');

			// Add active class to clicked item
			jQuery(element).addClass('active');

			// Update Right Panel Image with fade effect
			var img = jQuery('#previewImg');
			img.fadeOut(150, function() {
				img.attr('src', imagePath);
				img.fadeIn(150);
			});

			// Update Title
			jQuery('#previewTitle').text(title);

			// Update Button Data
			var btn = jQuery('#previewBtn');
			btn.attr('data-file', pdfPath);
			btn.attr('data-title', title);
		}

		jQuery(document).ready(function ($) {

			// 2. Click Event for the "Read Full Newsletter" button
			$('#previewBtn').on('click', function(e) {
				e.preventDefault();
				var pdfPath = $(this).attr('data-file');
				var pdfTitle = $(this).attr('data-title');

				if (!pdfPath || pdfPath === '') {
					alert("Document not found.");
					return;
				}

				openPdfPopup(pdfPath);
			});

			

		});
		// 3. Popup Logic
					function openPdfPopup(path) {

			// Safety check
			if (!path) return;

			// Create overlay + popup only when needed
			var popupHtml = `
				<div id="popupOverlay" class="popup-overlay"></div>
				<div id="popup">
					<div class="popup-close">&times;</div>
					<div id="pdfreader" style="width:100%; height:100%;"></div>
				</div>
			`;

			$('body').append(popupHtml);

			$('#popupOverlay, #popup').fadeIn();

			if (typeof PDFObject !== 'undefined' && PDFObject.supportsPDFs) {
				PDFObject.embed(path, "#pdfreader");
			} else {
				$("#pdfreader").html(
					'<iframe src="' + path + '" style="width:100%; height:100%; border:none;"></iframe>'
				);
			}

			// Close handler
			$('.popup-close, #popupOverlay').on('click', function () {
				$('#popup, #popupOverlay').fadeOut(function () {
					$('#popup, #popupOverlay').remove();
				});
			});
		}


			// Close Popup
			$('.popup-close, #popupOverlay').on('click', function() {
				$('#popup').fadeOut();
				$('#popupOverlay').fadeOut();
				$('#pdfreader').empty();
			});
	</script>
}
<style>
	/* --- Layout Container --- */
	.split-container {
		display: flex;
		flex-wrap: wrap;
		max-width: 1200px;
		margin: 0 auto;
		padding: 20px;
		gap: 30px;
		align-items: flex-start; /* Ensures right side doesn't stretch weirdly */
	}

	/* --- Left Side: The List --- */
	.list-panel {
		flex: 1;
		min-width: 300px;
		height: 600px; /* Fixed height for scrolling */
		overflow-y: auto;
		padding-right: 10px;
	}

		/* Custom Scrollbar for the list */
		.list-panel::-webkit-scrollbar {
			width: 6px;
		}

		.list-panel::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		.list-panel::-webkit-scrollbar-thumb {
			background: #ccc;
			border-radius: 3px;
		}

			.list-panel::-webkit-scrollbar-thumb:hover {
				background: #007bff;
			}

	.list-item {
		display: flex;
		align-items: center;
		background: #fff;
		border: 1px solid #eee;
		padding: 15px;
		margin-bottom: 15px;
		border-radius: 8px;
		cursor: pointer;
		transition: all 0.2s ease;
	}

		.list-item:hover {
			background-color: #f9f9f9;
			transform: translateX(5px);
			border-color: #ddd;
		}

		.list-item.active {
			background-color: #e6f2ff; /* Light blue active state */
			border-left: 5px solid #007bff;
			box-shadow: 0 4px 10px rgba(0,0,0,0.05);
		}

		.list-item img {
			width: 60px;
			height: 60px;
			object-fit: cover;
			border-radius: 6px;
			margin-right: 15px;
		}

	.list-item-info h4 {
		margin: 0;
		font-size: 16px;
		color: #333;
		font-weight: 600;
	}

	/* --- Right Side: The Preview --- */
	.preview-panel {
		flex: 1;
		min-width: 300px;
		background: #fff;
		border-radius: 12px;
		padding: 30px;
		text-align: center;
		box-shadow: 0 10px 30px rgba(0,0,0,0.1);
		border: 1px solid #e0e0e0;
		position: sticky;
		top: 20px; /* Keeps it in view while scrolling the list */
	}

	.preview-image-container {
		width: 100%;
		height: 350px;
		background-color: #f8f8f8;
		border-radius: 8px;
		margin-bottom: 20px;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
		border: 1px solid #eee;
	}

		.preview-image-container img {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
			transition: opacity 0.3s;
		}

	.preview-title {
		font-size: 24px;
		color: #222;
		margin-bottom: 20px;
		font-weight: 700;
	}

	.btn-preview-read {
		display: inline-block;
		padding: 12px 40px;
		background-color: #5076bb;
		color: white !important;
		border-radius: 30px;
		text-decoration: none;
		font-size: 16px;
		font-weight: 600;
		box-shadow: 0 4px 15px rgba(0,123,255,0.3);
		transition: transform 0.2s, background 0.2s;
		cursor: pointer;
	}

		.btn-preview-read:hover {
			background-color: #0056b3;
			transform: translateY(-2px);
		}



	.list-panel {
		height: auto;
		max-height: 500px;
		width: 100%;
	}

	.preview-panel {
		position: static;
		width: 100%;
	}

	}

	/* Popup Styles */
	.popup-overlay {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0,0,0,0.8);
		z-index: 9998;
	}

	#popup {
		display: none;
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 85%;
		height: 90%;
		background: #fff;
		z-index: 9999;
		padding: 10px;
		border-radius: 8px;
	}

	.popup-close {
		position: absolute;
		top: -15px;
		right: -15px;
		background: red;
		color: white;
		width: 30px;
		height: 30px;
		border-radius: 50%;
		text-align: center;
		line-height: 30px;
		cursor: pointer;
		font-weight: bold;
		box-shadow: 0 2px 5px rgba(0,0,0,0.3);
	}

</style>
@section styles {
	<link rel="stylesheet" href="@Url.Content("~/images/CampusCommittee/Placement/graph.css")" />
}